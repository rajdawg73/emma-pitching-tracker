<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emma Pitching Tracker – GitHub Edition (v5)</title>
<style>
  :root{--bg:#0f172a;--panel:#111827;--ink:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--line:#1f2937}
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1226,#0f172a);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
  header{position:sticky;top:0;z-index:5;background:rgba(15,23,42,.9);border-bottom:1px solid var(--line);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:space-between;gap:.5rem;padding:.75rem 1rem}
  h1{font-size:1rem;margin:0}
  .tabs{display:flex;gap:.5rem;flex-wrap:wrap}
  .tabs button{border:1px solid var(--line);background:#0b1226;color:var(--ink);padding:.45rem .7rem;border-radius:.6rem;font-weight:600;cursor:pointer}
  .tabs button.active{background:var(--accent);color:#001;border-color:transparent}
  main{max-width:1100px;margin:0 auto;padding:1rem;display:grid;gap:1rem}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:1rem;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .hidden{display:none}
  .grid{display:grid;gap:.75rem}
  .grid.two{grid-template-columns:repeat(2,1fr)}
  .grid.three{grid-template-columns:repeat(3,1fr)}
  .grid.auto{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  label{font-size:.9rem;color:var(--muted);display:block;margin-bottom:.25rem}
  input,select,textarea{width:100%;padding:.6rem;border-radius:.6rem;border:1px solid #374151;background:#0b1226;color:var(--ink)}
  textarea{min-height:80px}
  .row{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
  .btn{background:var(--accent);border:0;color:#001;font-weight:700;padding:.6rem .9rem;border-radius:.6rem;cursor:pointer}
  .btn.outline{background:transparent;color:var(--accent);border:1px solid var(--accent)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:.5rem;border-bottom:1px solid var(--line);text-align:center}
  th{color:var(--muted)}
  .hint{font-size:.85rem;color:var(--muted)}
  .pill{background:#0b1226;border:1px solid var(--line);border-radius:.6rem;padding:.35rem .6rem;display:inline-block}
  @media (max-width:720px){ .grid.two,.grid.three{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <h1>Emma Pitching Tracker</h1>
  <div class="tabs">
    <button type="button" data-view="dashboard" class="active">Dashboard</button>
    <button type="button" data-view="logA">Log Bullpen A</button>
    <button type="button" data-view="logB">Log Bullpen B</button>
    <button type="button" data-view="nightly">Nightly Routine</button>
    <button type="button" data-view="data">Data</button>
  </div>
</header>

<main>
  <section id="dashboard" class="card">
    <h2 style="margin-top:0">Overview</h2>
    <div class="grid three">
      <div class="card"><div class="hint">This Month Strike %</div><h3 id="kpiStrike">—</h3></div>
      <div class="card"><div class="hint">ABs Won % (B)</div><h3 id="kpiABs">—</h3></div>
      <div class="card"><div class="hint">Nightly Change Clean %</div><h3 id="kpiChange">—</h3></div>
    </div>
    <div class="grid two" style="margin-top:1rem">
      <div class="card">
        <h3 style="margin-top:0">Recent Sessions</h3>
        <table id="recent"><thead><tr><th>Date</th><th>Type</th><th>Total</th><th>Strike %</th><th>Notes</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="card">
        <h3 style="margin-top:0">Monthly Averages</h3>
        <table id="avg"><thead><tr><th>Metric</th><th>Avg</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
  </section>

  <!-- BULLPEN A -->
  <section id="logA" class="card hidden">
    <h2 style="margin-top:0">Bullpen A — Command & Precision (25–30 min)</h2>
    <p class="hint">Enter values as <b>x/y</b> (e.g., 4/5). Totals & Strike% auto‑calculate. Tempo: 60% → 100%.</p>
    <form id="formA">
      <div class="grid three">
        <div><label>Date</label><input type="date" name="date" required></div>
        <div><label>Notes</label><input type="text" name="notesA" placeholder="tilt? cues?"></div>
        <div><label>Go‑To Pitch</label><select name="gotoA"><option>Drop</option><option>Change</option></select></div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Spin Purity (not strikes)</h3>
          <div class="hint">Stick spinner → clean spiral</div>
          <label>Clean Drop Spins</label><input type="text" name="cleanDropA" placeholder="e.g., 4/6">
          <label>Clean Change Spins</label><input type="text" name="cleanChgA" placeholder="e.g., 5/6">
        </div>
        <div class="card">
          <h3>Power Line Lanes (not strikes)</h3>
          <div class="hint">5 middle • 5 inside • 5 outside</div>
          <label>Middle</label><input type="text" name="midA" placeholder="5/5">
          <label>Inside</label><input type="text" name="inA" placeholder="5/5">
          <label>Outside</label><input type="text" name="outA" placeholder="5/5">
        </div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Location / Accuracy (strikes)</h3>
          <label>Low‑In Drops</label><input type="text" name="lowInA" placeholder="e.g., 4/5">
          <label>Low‑Out Drops</label><input type="text" name="lowOutA" placeholder="e.g., 3/5">
          <label>Change Targets</label><input type="text" name="chgTargetsA" placeholder="e.g., 5/8">
        </div>
        <div class="card">
          <h3>Competitive Finish (strikes)</h3>
          <label>Pressure Strikes</label><input type="text" name="pressureA" placeholder="e.g., 6/8">
          <label>Extra Notes</label><input type="text" name="notesA2" placeholder="poise, breath, reset">
        </div>
      </div>

      <div class="row">
        <button class="btn" type="submit">Save Bullpen A</button>
        <button class="btn outline" type="button" id="resetA">Reset</button>
        <span class="pill">Auto Total: <b id="autoTotalA">0</b></span>
        <span class="pill">Auto Strike %: <b id="autoStrikeA">0%</b></span>
      </div>
    </form>
  </section>

  <!-- BULLPEN B -->
  <section id="logB" class="card hidden">
    <h2 style="margin-top:0">Bullpen B — Game/Pressure (25–30 min)</h2>
    <p class="hint">Enter values as <b>x/y</b>. Strike% from pressure blocks only.</p>
    <form id="formB">
      <div class="grid three">
        <div><label>Date</label><input type="date" name="date" required></div>
        <div><label>Notes</label><input type="text" name="notesB" placeholder="mix feel, hitter types"></div>
        <div><label>Go‑To Pitch</label><select name="gotoB"><option>Drop</option><option>Change</option></select></div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Sequence Builder</h3>
          <label>Total Sequence Pitches</label><input type="number" name="seqTotalB" placeholder="e.g., 20">
          <label>Combos Executed</label><input type="text" name="combosB" placeholder="e.g., 4/6">
        </div>
        <div class="card">
          <h3>Simulated At‑Bats</h3>
          <label>ABs Won</label><input type="text" name="absWonB" placeholder="e.g., 6/10">
          <label>Called Mix Felt Good?</label><select name="mixFeelB"><option>Yes</option><option>No</option></select>
        </div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Pressure Situations (strikes)</h3>
          <label>3–2 Count Strikes</label><input type="text" name="threeTwoB" placeholder="e.g., 3/5">
          <label>2–0 Comebacks</label><input type="text" name="twoOhB" placeholder="e.g., 4/5">
          <label>Bases Loaded Exec</label><input type="text" name="basesB" placeholder="e.g., 4/5">
        </div>
        <div class="card">
          <h3>Closer (strikes)</h3>
          <label>Pressure Strikes</label><input type="text" name="pressureB" placeholder="e.g., 6/8">
        </div>
      </div>

      <div class="row">
        <button class="btn" type="submit">Save Bullpen B</button>
        <button class="btn outline" type="button" id="resetB">Reset</button>
        <span class="pill">Auto Total: <b id="autoTotalB">0</b></span>
        <span class="pill">Auto Strike %: <b id="autoStrikeB">0%</b></span>
      </div>
    </form>
  </section>

  <!-- NIGHTLY -->
  <section id="nightly" class="card hidden">
    <h2 style="margin-top:0">Nightly Routine (10–12 min)</h2>
    <p class="hint">Spinner (drop) • Change‑up release • Stride lanes • (Optional) shadow reps</p>
    <form id="formN">
      <div class="grid three">
        <div><label>Date</label><input type="date" name="date" required></div>
        <div><label>Completed?</label><select name="done"><option>Yes</option><option>No</option></select></div>
        <div><label>Notes</label><input type="text" name="notes" placeholder="feel, cues, soreness"></div>
      </div>
      <div class="grid two">
        <div class="card">
          <h3>Spinner – Drop Spin</h3>
          <label>Spins Done</label><input type="number" name="spinCount" min="0" max="30">
          <label>“Clean” Spins</label><input type="number" name="spinClean" min="0" max="30">
          <label>Tilt Issues?</label><select name="tilt"><option>No</option><option>Yes</option></select>
        </div>
        <div class="card">
          <h3>Change‑Up – Release</h3>
          <label>Reps Done</label><input type="number" name="chgCount" min="0" max="30">
          <label>“Float” Success</label><input type="number" name="chgClean" min="0" max="30">
          <label>Bullet Spin?</label><select name="bullet"><option>No</option><option>Yes</option></select>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h3>Stride Footwork</h3>
          <label>Middle OK</label><input type="number" name="midN" min="0" max="5">
          <label>Inside OK</label><input type="number" name="inN" min="0" max="5">
          <label>Outside OK</label><input type="number" name="outN" min="0" max="5">
        </div>
        <div class="card">
          <h3>Optional Shadow Reps</h3>
          <label>Drops Done</label><input type="number" name="dropsN" min="0" max="30">
          <label>Changes Done</label><input type="number" name="changesN" min="0" max="30">
          <label>Mirror Used?</label><select name="mirror"><option>Yes</option><option>No</option></select>
        </div>
      </div>
      <div class="row">
        <button class="btn" type="submit">Save Nightly</button>
        <button class="btn outline" type="button" id="resetN">Reset</button>
      </div>
    </form>
  </section>

  <!-- DATA -->
  <section id="data" class="card hidden">
    <h2 style="margin-top:0">Data & Export</h2>
    <div class="row" style="margin-bottom:.5rem">
      <button type="button" class="btn" id="exportCsv">Export CSV</button>
      <button type="button" class="btn outline" id="clearAll">Clear All Data</button>
    </div>
    <div class="grid two">
      <div>
        <h3>Bullpen A Entries</h3>
        <table id="tableA"><thead></thead><tbody></tbody></table>
      </div>
      <div>
        <h3>Bullpen B Entries</h3>
        <table id="tableB"><thead></thead><tbody></tbody></table>
      </div>
    </div>
    <div style="margin-top:1rem">
      <h3>Nightly Routine Entries</h3>
      <table id="tableN"><thead></thead><tbody></tbody></table>
    </div>
  </section>
</main>

<script>
(function(){
  // Tabs
  const tabs = document.querySelectorAll('.tabs button');
  const sections = ['dashboard','logA','logB','nightly','data'];
  function show(view){
    sections.forEach(id => document.getElementById(id).classList.toggle('hidden', id!==view));
    tabs.forEach(b => b.classList.toggle('active', b.dataset.view===view));
    if(view==='dashboard') renderDashboard();
    if(view==='data') renderTables();
  }
  tabs.forEach(b=> b.addEventListener('click', ()=> show(b.dataset.view)));
  show('dashboard');

  // Storage helpers
  const get = k => JSON.parse(localStorage.getItem(k) || '[]');
  const set = (k,v) => localStorage.setItem(k, JSON.stringify(v));

  // Parse "x/y"
  function parseXY(s, fallbackY){
    if(!s) return {x:0,y:(fallbackY||0)};
    const parts = String(s).split('/').map(p=>p.trim());
    let x = Number(parts[0]); let y = parts.length>1? Number(parts[1]) : (fallbackY||0);
    if(isNaN(x)) x = 0; if(isNaN(y)) y = 0;
    return {x,y};
  }

  // ---------- Bullpen A ----------
  const formA = document.getElementById('formA');
  function calcA(){
    const fd = Object.fromEntries(new FormData(formA).entries());
    const drop = parseXY(fd.cleanDropA, 0);
    const chg  = parseXY(fd.cleanChgA, 0);
    const mid  = parseXY(fd.midA, 5);
    const inn  = parseXY(fd.inA, 5);
    const out  = parseXY(fd.outA, 5);
    const lowIn  = parseXY(fd.lowInA, 5);
    const lowOut = parseXY(fd.lowOutA, 5);
    const chgT   = parseXY(fd.chgTargetsA, 8);
    const press  = parseXY(fd.pressureA, 8);

    const attemptsSpin = drop.y + chg.y;
    const attemptsLane = mid.y + inn.y + out.y;
    const attemptsAcc  = lowIn.y + lowOut.y + chgT.y;
    const attemptsPres = press.y;

    const totalPitches = attemptsSpin + attemptsLane + attemptsAcc + attemptsPres;
    const strikeMakes  = lowIn.x + lowOut.x + chgT.x + press.x;
    const strikeAtt    = attemptsAcc + attemptsPres;
    const strikePct    = strikeAtt ? Math.round((strikeMakes/strikeAtt)*100) : 0;

    document.getElementById('autoTotalA').textContent = String(totalPitches);
    document.getElementById('autoStrikeA').textContent = String(strikePct)+'%';
    return {totalPitches, strikePct};
  }
  formA.addEventListener('input', calcA);
  formA.addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = Object.fromEntries(new FormData(formA).entries());
    const totals = calcA();
    fd.type='A'; fd.total = totals.totalPitches; fd.strike = totals.strikePct;
    const list=get('bullpenA'); list.unshift(fd); set('bullpenA',list);
    alert('Saved Bullpen A'); formA.reset();
    document.getElementById('autoTotalA').textContent='0'; document.getElementById('autoStrikeA').textContent='0%';
    renderDashboard();
  });
  document.getElementById('resetA').onclick = ()=>{ formA.reset(); document.getElementById('autoTotalA').textContent='0'; document.getElementById('autoStrikeA').textContent='0%'; };

  // ---------- Bullpen B ----------
  const formB = document.getElementById('formB');
  function calcB(){
    const fd = Object.fromEntries(new FormData(formB).entries());
    const seqTotal = Number(fd.seqTotalB || 0);
    const threeTwo = parseXY(fd.threeTwoB, 5);
    const twoOh    = parseXY(fd.twoOhB, 5);
    const bases    = parseXY(fd.basesB, 5);
    const press    = parseXY(fd.pressureB, 8);

    const attemptsPress = threeTwo.y + twoOh.y + bases.y + press.y;
    const makesPress    = threeTwo.x + twoOh.x + bases.x + press.x;

    const totalPitches = seqTotal + attemptsPress; // ABs are conceptual
    const strikePct    = attemptsPress ? Math.round((makesPress/attemptsPress)*100) : 0;

    document.getElementById('autoTotalB').textContent = String(totalPitches);
    document.getElementById('autoStrikeB').textContent = String(strikePct)+'%';
    return {totalPitches, strikePct};
  }
  formB.addEventListener('input', calcB);
  formB.addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = Object.fromEntries(new FormData(formB).entries());
    const totals = calcB();
    fd.type='B'; fd.total = totals.totalPitches; fd.strike = totals.strikePct;
    const list=get('bullpenB'); list.unshift(fd); set('bullpenB',list);
    alert('Saved Bullpen B'); formB.reset();
    document.getElementById('autoTotalB').textContent='0'; document.getElementById('autoStrikeB').textContent='0%';
    renderDashboard();
  });
  document.getElementById('resetB').onclick = ()=>{ formB.reset(); document.getElementById('autoTotalB').textContent='0'; document.getElementById('autoStrikeB').textContent='0%'; };

  // ---------- Nightly ----------
  const formN = document.getElementById('formN');
  formN.addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = Object.fromEntries(new FormData(formN).entries());
    const list=get('nightly'); list.unshift(fd); set('nightly',list);
    alert('Saved Nightly'); formN.reset(); renderDashboard();
  });
  document.getElementById('resetN').onclick = ()=> formN.reset();

  // Dashboard helpers
  const avg = arr => {
    const nums = arr.map(Number).filter(n=>!isNaN(n));
    if(!nums.length) return null;
    return Math.round(nums.reduce((a,b)=>a+b,0)/nums.length);
  };

  function renderDashboard(){
    const A=get('bullpenA'), B=get('bullpenB'), N=get('nightly');
    const month = new Date().toISOString().slice(0,7);
    const inMonth = d => (d?.date||'').startsWith(month);

    const strikeA = avg(A.filter(inMonth).map(x=>x.strike));
    const strikeB = avg(B.filter(inMonth).map(x=>x.strike));
    const strikeAvg = avg([strikeA, strikeB].filter(v=>v!=null));

    const abWon = B.filter(inMonth).map(x=>{
      if(!x.absWonB) return null;
      const parts = String(x.absWonB).split('/'); const made=Number(parts[0]||0), tot=Number(parts[1]||0);
      return tot? Math.round((made/tot)*100) : null;
    }).filter(v=>v!=null);
    const abAvg = avg(abWon);

    const changeClean = avg(N.filter(inMonth).map(x=>{
      const denom = Number(x.chgCount||0); const num = Number(x.chgClean||0);
      return denom? Math.round((num/denom)*100) : null;
    }).filter(v=>v!=null));

    document.getElementById('kpiStrike').textContent = strikeAvg!=null? (strikeAvg+'%') : '—';
    document.getElementById('kpiABs').textContent = abAvg!=null? (abAvg+'%') : '—';
    document.getElementById('kpiChange').textContent = changeClean!=null? (changeClean+'%') : '—';

    const recent = [...A.map(x=>({...x,_type:'A'})), ...B.map(x=>({...x,_type:'B'}))]
                    .sort((a,b)=> (b.date||'').localeCompare(a.date||''))
                    .slice(0,6);
    const tbody = document.querySelector('#recent tbody');
    tbody.innerHTML = recent.map(x=> `<tr><td>${x.date||''}</td><td>${x._type}</td><td>${x.total||''}</td><td>${x.strike||''}%</td><td>${x.notesA||x.notesA2||x.notesB||''}</td></tr>`).join('')
                   || `<tr><td colspan="5" class="hint">No entries yet</td></tr>`;

    const avgRows = [
      ['Strike % (this month)', strikeAvg!=null? strikeAvg+'%':'—'],
      ['ABs Won % (B)', abAvg!=null? abAvg+'%':'—'],
      ['Nightly Change “clean %”', changeClean!=null? changeClean+'%':'—']
    ];
    document.querySelector('#avg tbody').innerHTML = avgRows.map(r=> `<tr><td>${r[0]}</td><td>${r[1]}</td></tr>`).join('');
  }

  // Data tables + export
  function renderTable(sel, rows, cols){
    const table = document.querySelector(sel);
    table.querySelector('thead').innerHTML = `<tr>${cols.map(c=> `<th>${c}</th>`).join('')}</tr>`;
    table.querySelector('tbody').innerHTML = rows.map(r=> `<tr>${cols.map(c=> `<td>${r[c] || ''}</td>`).join('')}</tr>`).join('')
      || `<tr><td colspan="${cols.length}" class="hint">No entries</td></tr>`;
  }
  function renderTables(){
    const A=get('bullpenA'), B=get('bullpenB'), N=get('nightly');
    renderTable('#tableA', A, ['date','total','strike','cleanDropA','cleanChgA','midA','inA','outA','lowInA','lowOutA','chgTargetsA','pressureA','gotoA','notesA','notesA2']);
    renderTable('#tableB', B, ['date','total','strike','seqTotalB','combosB','absWonB','mixFeelB','threeTwoB','twoOhB','basesB','pressureB','gotoB','notesB']);
    renderTable('#tableN', N, ['date','done','spinCount','spinClean','tilt','chgCount','chgClean','bullet','midN','inN','outN','dropsN','changesN','mirror','notes']);
  }

  document.getElementById('clearAll').addEventListener('click', ()=>{
    if(confirm('Clear all stored data?')){
      ['bullpenA','bullpenB','nightly'].forEach(k=> localStorage.removeItem(k));
      renderDashboard(); renderTables();
    }
  });

  document.getElementById('exportCsv').addEventListener('click', ()=>{
    const A=get('bullpenA'), B=get('bullpenB'), N=get('nightly');
    function toCSV(rows){
      if(!rows.length) return 'No data';
      const cols = Object.keys(rows[0]);
      const head = cols.join(',');
      const body = rows.map(r=> cols.map(c=> JSON.stringify(r[c] || '')).join(',')).join('\n');
      return head + '\n' + body;
    }
    const csv = ['--- Bullpen A ---', toCSV(A), '--- Bullpen B ---', toCSV(B), '--- Nightly ---', toCSV(N)].join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='emma_pitching_data.csv'; a.click();
    setTimeout(()=> URL.revokeObjectURL(url), 5000);
  });

  // initial render
  renderDashboard();
})();
</script>
</body>
</html>
